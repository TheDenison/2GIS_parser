
---

# üïµÔ∏è‚Äç‚ôÇÔ∏è 2GIS Parser & Telegram Bot

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç **card_finder.py** ‚Äî —ç—Ç–æ –ø–∞—Ä—Å–µ—Ä –∫–æ–º–ø–∞–Ω–∏–π –∏–∑ [2gis.ru](https://2gis.ru), –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö –≤ –ú–æ—Å–∫–≤–µ, —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∏—Ö –ø–æ —Ä–∞–π–æ–Ω–∞–º –∏ —Ç–∏–ø–∞–º –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ **Excel** –∏ **JSON**.
–°–∫—Ä–∏–ø—Ç **run_bot.py** ‚Äî Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –ü–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, *flowers*, *pharmacy*, *cafe* –∏ —Ç. –¥.)
* –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

  * –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å, —Å–∞–π—Ç, —Ä–µ–π—Ç–∏–Ω–≥, –æ—Ç–∑—ã–≤—ã, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, email, –∫–∞—Ç–µ–≥–æ—Ä–∏—è
  * –ò–ù–ù/–ò–ü –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ –∫–æ–º–ø–∞–Ω–∏–∏
* –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

  * `Excels/Table_<chat_id>.xlsx`
  * `Excels/data.json`
* Telegram-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –≤ `logs.log`.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project_root/
‚îú‚îÄ‚îÄ card_finder.py          # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä 2GIS
‚îú‚îÄ‚îÄ run_bot.py              # Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–æ–º
‚îú‚îÄ‚îÄ soup_content.py         # –ö–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ —Ä–∞–∑–±–æ—Ä–∞ HTML
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ save_to_exel.py     # –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Excel
‚îÇ   ‚îú‚îÄ‚îÄ save_to_json.py     # –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ JSON
‚îÇ   ‚îú‚îÄ‚îÄ constants.py        # –°–ø–∏—Å–∫–∏ —Ä–∞–π–æ–Ω–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
‚îú‚îÄ‚îÄ Excels/                 # –ö–∞—Ç–∞–ª–æ–≥ —Å –≤—ã–≥—Ä—É–∑–∫–∞–º–∏ (xlsx/json)
‚îú‚îÄ‚îÄ backups/                # –†–µ–∑–µ—Ä–≤–Ω—ã–µ JSON-—Ñ–∞–π–ª—ã —Å –Ω–æ–≤—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏
‚îú‚îÄ‚îÄ logs.log                # –§–∞–π–ª –ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ firms_dict.json         # –ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
‚îú‚îÄ‚îÄ fresh_firms_dict.json   # –ù–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫
‚îî‚îÄ‚îÄ tg_bot/
    ‚îú‚îÄ‚îÄ auth_tg.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram-—Ç–æ–∫–µ–Ω–∞ –∏ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* **Python 3.10+**
* **Google Chrome** –∏ **chromedriver** —Ç–æ–π –∂–µ –≤–µ—Ä—Å–∏–∏.
* –ê–∫–∫–∞—É–Ω—Ç Telegram –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –±–æ—Ç —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather).

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

(–ï—Å–ª–∏ —Ñ–∞–π–ª–∞ `requirements.txt` –Ω–µ—Ç, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é:)

```bash
pip install selenium beautifulsoup4 tqdm aiogram aiofiles lxml
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 1. Telegram-—Ç–æ–∫–µ–Ω –∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–í —Ñ–∞–π–ª–µ `tg_bot/auth_tg.py` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–¥–∞–Ω—ã:

```python
token = "–í–ê–®_TELEGRAM_BOT_TOKEN"
ALLOWED_USER_IDS = [123456789, 987654321]  # —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ Telegram ID
```

### 2. –ö–∞—Ä—Ç–∞ —Ç–∏–ø–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

–§–∞–π–ª `utils/constants.py` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

```python
type_org_mapping = {
    "flowers": "–ú–∞–≥–∞–∑–∏–Ω—ã —Ü–≤–µ—Ç–æ–≤",
    "pharmacy": "–ê–ø—Ç–µ–∫–∏",
    "cafe": "–ö–∞—Ñ–µ",
    ...
}
districts = ["–¢–≤–µ—Ä—Å–∫–æ–π —Ä–∞–π–æ–Ω", "–ü—Ä–µ—Å–Ω–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω", ...]
```

---

## –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é

```bash
python card_finder.py flowers
```

–ü–∞—Ä—Å–µ—Ä:

1. –û–±–Ω–æ–≤–∏—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π (`update_list`)
2. –°–ø–∞—Ä—Å–∏—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (`parse_info`)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ JSON –∏ Excel

---

## –ó–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞

```bash
python run_bot.py
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –±—É–¥–µ—Ç –æ–∂–∏–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã.

### –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                     |
| --------- | -------------------------------------------------------------- |
| `/start`  | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –º–µ–Ω—é                                             |
| `/help`   | –ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π                               |
| `/run`    | –ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π                                   |
| `<—Å–ª–æ–≤–æ>` | –í–≤–æ–¥ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `flowers`) |

---

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/start`
2. –í—ã–±–∏—Ä–∞–µ—Ç `/help` –∏ —Å–º–æ—Ç—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. –í–≤–æ–¥–∏—Ç `flowers`
4. –ë–æ—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äú–ú–∞–≥–∞–∑–∏–Ω—ã —Ü–≤–µ—Ç–æ–≤‚Äù –≤ –ú–æ—Å–∫–≤–µ
5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ —Ñ–∞–π–ª–æ–º `–¢–∞–±–ª–∏—Ü–∞_flowers.xlsx`

---

## –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `logs.log` –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```
2025-10-15 14:22:31 - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Ivan –Ω–∞—á–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞.
2025-10-15 14:23:02 - [–°–æ–æ–±—â–µ–Ω–∏–µ] Ivan: flowers
2025-10-15 14:25:17 - –ü–æ–∏—Å–∫ –ø–æ flowers –∑–∞–≤–µ—Ä—à–µ–Ω
```

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞                                                | –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞                                         |
| ------------------------------------------------------- | --------------------------------------------------------- |
| `selenium.common.exceptions.SessionNotCreatedException` | –í–µ—Ä—Å–∏–∏ Chrome –∏ chromedriver –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç                 |
| `Telegram error: RetryAfter`                            | –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π                         |
| –§–∞–π–ª Excel –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è                                 | –û—à–∏–±–∫–∞ –≤ `utils/save_to_exel.py` –∏–ª–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –¥–∞–Ω–Ω—ã—Ö |
| `–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª`                            | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `fresh_firms_dict.json`                       |

